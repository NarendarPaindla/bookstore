{% extends 'base.html' %}
{% block content %}

<div class="container mt-1">
  <div class="detail-grid">
    <div class="cover-column">
      {% if book.cover_img %}
        <img src="{{ book.cover_img.url }}" alt="{{ book.title }}">
      {% endif %}
      {% if book.preview %}
        <button id="previewBtn" class="btn mt-1">Preview Book</button>
      {% endif %}
    </div>

    <div class="info-column">
      <h1>{{ book.title }}</h1>
      <p class="author">by {{ book.author }}</p>
      <p class="price">${{ book.price }}</p>
      <p class="desc">{{ book.description }}</p>
      <p><strong>Format:</strong> {{ book.get_book_format_display }}</p>
    </div>
  </div>
</div>

{% if book.preview %}
<div id="previewModal" class="modal hidden">
  <div class="modal-content">
    <span id="closeModal" class="modal-close">&times;</span>
    {% if book.preview.url|slice:"-4:" == ".pdf" %}
      <iframe src="{{ book.preview.url }}" width="100%" height="600px"></iframe>
    {% else %}
      <img src="{{ book.preview.url }}" alt="Preview" />
    {% endif %}
  </div>
</div>
{% endif %}

<div class="container mt-1">
  <div class="card-buttons">
    {% if book.book_format == 'ebook' %}
      {% if user.is_authenticated and order_exists %}
        <a href="{% url 'download_book' item_pk %}" class="btn">Download eBook</a>
      {% else %}
        <a href="{% url 'login' %}?next={% url 'book_detail' book.slug %}" class="btn">Login to Download</a>
      {% endif %}
    {% else %}
      <a href="{% url 'book_detail' book.slug %}" class="btn-view">View</a>
      <form method="post" action="{% url 'add_to_cart' book.slug %}" class="inline-form">
        {% csrf_token %}
        <input type="hidden" name="quantity" value="1">
        {% if user.is_authenticated %}
          <button type="submit" class="btn-add">Add to Cart</button>
        {% else %}
          <a href="{% url 'login' %}?next={% url 'book_detail' book.slug %}" class="btn-add">Login to Add</a>
        {% endif %}
      </form>
    {% endif %}
  </div>
  

</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
  const modal = document.getElementById('previewModal');
  document.getElementById('previewBtn')?.addEventListener('click', () => modal.classList.remove('hidden'));
  document.getElementById('closeModal')?.addEventListener('click', () => modal.classList.add('hidden'));
});
</script>

{% endblock %}
