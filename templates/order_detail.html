{% extends 'base.html' %}
{% block content %}
<div class="container mt-1">
  <h2>Order #{{ order.id }}</h2>
  <p>Placed on: {{ order.created }}</p>

  <ul class="timeline">
    <li class="{% if order.status == 'pending' %}active{% elif order.status == 'shipped' or order.status == 'delivered' or order.status == 'cancelled' %}complete{% endif %}">
      <div class="circle">✓</div><p>Pending</p>
    </li>
    <li class="{% if order.status == 'shipped' %}active{% elif order.status == 'delivered' or order.status == 'cancelled' %}complete{% endif %}">
      <div class="circle">✓</div><p>Shipped</p>
    </li>
    <li class="{% if order.status == 'delivered' %}active{% endif %}">
      <div class="circle">✓</div><p>Delivered</p>
    </li>
  </ul>

  <table class="orders-table">
    <thead>
      <tr>
        <th>Book</th><th>Qty</th><th>Price</th><th>Line Total</th>
      </tr>
    </thead>
    <tbody>
      {% for item in order.items.all %}
      <tr>
        <td>{{ item.book.title }}</td>
        <td>{{ item.quantity }}</td>
        <td>${{ item.price }}</td>
        <td>${{ item.price|floatformat:2|add:'0'|floatformat:2 }}</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>

  <p class="order-total"><strong>Total:</strong> ${{ order.total }}</p>

  <div class="order-actions">
    <a href="{% url 'invoice_pdf' order.id %}" class="btn">Download Invoice</a>
    {% if order.status == 'pending' %}
      <a href="{% url 'cancel_order' order.id %}" class="btn btn-sm">Cancel Order</a>
    {% endif %}
    {% if order.status == 'shipped' or order.status == 'delivered' or order.status == 'cancelled' %}
      <a href="{% url 'reorder' order.id %}" class="btn">Reorder</a>
    {% endif %}
  </div>
</div>
{% endblock %}
